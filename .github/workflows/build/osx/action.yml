name: Build
description: Build OSX artifacts

runs:
  using: "composite"
  steps:

  - name: Install Prerequisites
    shell: bash
    run: |
      set -ex
      brew update-reset
      brew install ninja hdf5 zlib

  - name: Build
    shell: bash
    run: |
      set -ex
      mkdir build
      cd build
      cmake ../ -G Ninja -DCMAKE_Fortran_COMPILER:string="gfortran-11" -DBUILD_SZIP:bool=true -DCMAKE_Fortran_FLAGS:string="-cpp" -DGUDPY_COMPATIBILITY=1 ${{ inputs.extraflags }}
      ninja
      ninja install
      cd ..
      mkdir osx
      mv bin osx/binaries-${{ env.gudrunVersion }}-osx-${{ env.TARGET }}

  - name: Upload Raw Build Artifacts
    uses: actions/upload-artifact@v4
    with:
      name: binaries-${{ env.gudrunVersion }}-osx-${{ env.TARGET }}
      path: osx/binaries-${{ env.gudrunVersion }}-osx-${{ env.TARGET }}
      retention-days: 1
