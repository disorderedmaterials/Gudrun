name: Package OSX

runs:
  using: "composite"
  steps:

  - name: Download OSX Artifacts
    uses: actions/download-artifact@v4
    with:
      path: binaries-${{ env.gudrunVersion }}-osx
      pattern: binaries-${{ env.gudrunVersion }}-osx-*

  - name: Create FAT Binaries
    shell: bash
    run: |
      set -ex
      lipo -create binaries-${{ env.gudrunVersion }}-osx/binaries-${{ env.gudrunVersion }}-osx-intel binaries-${{ env.gudrunVersion }}-osx/binaries-${{ env.gudrunVersion }}-osx-silicon -output binaries-${{ env.gudrunVersion }}-osx-fat

  - name: Create Zip
    shell: bash
    run: |
      set -ex
      zip -9rv binaries-${{ env.gudrunVersion }}-osx-fat.zip binaries-${{ env.gudrunVersion }}-osx-fat/

  - name: Upload Raw Build Artifacts
    uses: actions/upload-artifact@v4
    with:
      name: binaries-${{ env.gudrunVersion }}-osx-fat
      path: binaries-${{ env.gudrunVersion }}-osx-fat