parameters:
  - name: suffix
    default: linux
  - name: zipcommand
    default: "zip -9rv"
  - name: useMinGW
    default: false

steps:
  - bash: |
      set -ex
      VERSION=$(cat version)
      if [[ "${{ parameters.useMinGW }}" == "true" ]]; then
        MINGWLIB="C:\ProgramData\chocolatey\lib\mingw\tools\install\mingw64\bin\\"
        cp $MINGWLIB\libquadmath-0.dll bin/
        cp $MINGWLIB\libwinpthread-1.dll bin/
        cp $MINGWLIB\libgcc_s_seh-1.dll bin/
      fi
      mkdir binaries-${VERSION}-${{ parameters.suffix }}
      cp bin/* binaries-${VERSION}-${{ parameters.suffix }}
      ${{ parameters.zipcommand }} binaries-${VERSION}-${{ parameters.suffix }}.zip binaries-${VERSION}-${{ parameters.suffix }}/
    displayName: 'Create Binaries Zip'
  - bash: |
      set -ex
      mkdir packages
      mv binaries-*.zip packages
    displayName: 'Move Artifacts'